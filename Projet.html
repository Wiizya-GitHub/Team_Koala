<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LES NFT DES KOALAS</title>
    <link rel="stylesheet" href="main.css" />
</head>
<script>
    function search() {
        const searchBar = document.querySelector("#searchbar")

        searchBar.addEventListener("keyup", (e) => {
            const searchedLetters = e.target.value;
            const cards = document.querySelectorAll(".card_nft");
            filterElements(searchedLetters, cards);
        })
    }

    function filterElements(letters, elements) {
        if (letters.length >= 1) {
            for (let i = 0; i < elements.length; i++) {
                if (elements[i].textContent.toLowerCase().includes(letters)) {
                    elements[i].style.display = "block";
                } else {
                    elements[i].style.display = "none";
                }
            }
        }
    }

    //---------------------------------------------------- BONUS FUNCTION (sort by number of click with local storage) ----------------------------------------------------
    const clickButtonAttr = 'dataNbClick';
    class ClickList {
        constructor() {
            this.storageName = 'ClickList';
            this.list = this.initList();
        }
        initList() {
            if (window.localStorage.getItem(this.storageName)) {
                const list = JSON.parse(window.localStorage.getItem(this.storageName));
                console.log(list);
                return list;
            } else {
                let obj = {};
                return obj;
            }
        }
        initButton(button) {
            const id = parseInt(button.getAttribute(clickButtonAttr));
            const test = {
                Backcolour: 'red'
            };
            !inArrayClick(id, this.list) ? this.list[id] = 0 : this.list[id] = this.list[id] + 1;
            this.updateList();
            return button;
        }
        updateList() {
            setLocalStorage(this.storageName, this.list);
        }
    }

    function inArrayClick(element, array) {
        return array.hasOwnProperty(element) == true;
    }

    const clickButtons = document.querySelectorAll('.card');
    let clicks = new ClickList();
    clickButtons.forEach(button => clicks.initButton(button));

    //-------------------------------------------------------- FAVORITE LIST ----------------------------------------------------------------

    const favoriteButtonAttr = 'data-add-to-favorite';
    class FavoritesList {
        constructor() {
            this.storageName = 'favoritesList';
            this.list = this.initList();
        }
        initList() {
            if (window.localStorage.getItem(this.storageName)) {
                const list = JSON.parse(window.localStorage.getItem(this.storageName));
                console.log(list);
                return list;
            } else {
                return [];
            }
        }
        initButton(button) {
            const id = parseInt(button.getAttribute(favoriteButtonAttr));
            !inArray(id, this.list) ? this.list.push(id) : removeFromArray(id, this.list);
            this.updateList();
            button.classList.toggle('fav');
            return button;
        }

        updateList() {
            setLocalStorage(this.storageName, this.list);
        }
    }

    function inArray(element, array) {
        return array.indexOf(element) != -1;
    }

    function removeFromArray(element, array) {
        array.splice(array.indexOf(element), 1);
    }

    function setLocalStorage(key, value) {
        console.log(value)
        window.localStorage.setItem(key, JSON.stringify(value));
    }

    const buttons = document.querySelectorAll('.shop-item__favorite-button');
    let favorites = new FavoritesList();
    buttons.forEach(button => favorites.initButton(button));

</script>
<header>

    <label for="toggle">☰</label>
    <input type="checkbox" id="toggle">
    <nav>

        <ul class="main-nav">
            <li><a href="Projet.html"> <img href="Projet.html" class="img"><svg width="60" height="60"
                        viewBox="0 0 87 87" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M36.8062 85.1764C35.2298 85.1764 33.6516 85.2129 32.0769 85.1642C30.8589 85.1259 30.6605 84.8405 30.9598 83.7061C31.3304 82.2967 31.7602 80.9029 32.1343 79.4935C32.3083 78.8393 32.752 78.7732 33.3123 78.801C34.572 78.8619 35.8335 78.9489 37.095 78.935C39.3066 78.9089 40.8343 77.7187 41.4311 75.6081C41.6991 74.6598 41.9479 73.7045 42.141 72.7388C42.5517 70.6909 41.6591 68.883 39.806 67.9016C38.762 67.3483 37.7197 66.7898 36.6774 66.2347C35.9762 65.8606 35.79 65.3317 36.0458 64.5591C37.0046 61.6759 37.7597 58.7353 38.3652 55.7582C38.5392 54.9004 38.9899 54.6063 39.8408 54.608C41.1005 54.6133 42.362 54.5228 43.6218 54.4427C45.581 54.3175 47.0322 53.183 47.6273 51.3003C47.8639 50.5504 48.0605 49.783 48.2171 49.0105C48.7983 46.1429 46.8495 43.7087 43.9211 43.6165C43.6844 43.6095 43.4478 43.6182 43.2111 43.613C41.9322 43.5851 41.713 43.3259 42.0871 42.1148C43.2407 38.3773 43.7018 34.478 44.7963 30.7283C44.939 30.2359 45.1391 29.7591 45.2487 29.2597C45.4644 28.2801 45.936 27.6363 47.027 27.5302C47.4393 27.4901 47.883 27.2918 48.2171 27.0395C49.1045 26.3696 49.9084 25.8058 50.8898 26.9455C51.2534 27.3683 51.4866 26.8202 51.6728 26.5697C52.7707 25.1029 53.3519 23.4638 53.3223 21.6142C53.3171 21.294 53.0613 20.6519 53.7695 20.8225C54.81 21.0748 54.6777 20.4501 54.6081 19.8481C54.2619 16.9144 53.2196 14.3427 50.6844 12.6027C50.145 12.2338 49.9815 11.8267 50.0981 11.2072C50.6375 8.32926 51.6206 5.57832 52.5201 2.8065C52.7202 2.1888 53.2005 1.82688 53.853 1.80078C56.2942 1.70856 58.7389 1.48932 61.1784 1.76946C62.6487 1.93824 62.8505 2.2932 62.5164 3.72696C61.9353 6.22212 61.3646 8.72076 60.7434 11.2072C60.5676 11.9102 60.585 12.1851 61.4533 12.1277C65.819 11.8354 70.2038 11.8319 74.5294 11.021C76.1232 10.7218 76.9602 11.5987 76.6748 13.21C76.3668 14.9517 75.3072 16.1175 73.6298 16.6586C70.6179 17.6313 67.4928 18.1011 64.3956 18.6875C62.8453 18.9815 61.2984 19.2982 59.7394 19.5296C59.0504 19.6323 58.7563 19.8933 58.6049 20.5997C58.0481 23.1819 57.3869 25.7397 56.8005 28.3149C56.6457 28.9918 56.4665 29.2702 55.6382 29.1431C53.3188 28.7864 51.4274 30.0566 50.7558 32.2943C50.507 33.1243 50.2964 33.9682 50.1381 34.8208C49.8318 36.4685 50.2581 37.9858 51.6084 38.9446C53.5467 40.3226 53.8269 41.9513 53.2005 44.1298C52.1339 47.8394 51.2726 51.61 50.3364 55.358C50.2181 55.8295 49.9658 56.1271 49.4908 56.2332C49.376 56.2593 49.2611 56.2924 49.1463 56.3185C44.189 57.406 44.1368 58.5944 43.1729 63.4333C42.8179 65.2186 43.7697 66.7602 45.3078 67.6058C47.0148 68.5454 46.9817 69.6434 46.5363 71.3138C45.4627 75.3488 44.6066 79.4431 43.7366 83.5303C43.4513 84.8666 42.7031 85.3747 41.4259 85.3608C39.8877 85.3451 38.3496 85.3573 36.8097 85.3573C36.8045 85.2999 36.8045 85.2373 36.8062 85.1764Z"
                            fill="white" />
                        <path
                            d="M11.8268 15.4457C11.2804 15.1168 10.7445 15.4648 10.2729 15.2456C10.6818 13.1436 12.8673 11.1409 15.2859 10.6502C18.2421 10.0517 21.047 11.1479 22.6791 13.6848C23.1716 14.4504 23.4848 14.4295 24.2173 14.0363C26.4532 12.8374 28.8579 12.305 31.407 12.6077C32.1952 12.7017 33.0304 12.8061 32.0264 13.9632C34.5268 14.1354 36.7766 14.6905 38.8977 15.6736C39.6111 16.0042 39.7973 15.5031 40.1244 15.1533C43.1085 11.9761 47.8326 11.9552 50.6844 15.1325C51.1003 15.5953 51.4518 16.1382 51.7389 16.6915C52.6263 18.4019 52.5306 18.5516 50.6357 18.482C51.5771 20.1558 51.892 21.8645 51.2395 23.688C50.9646 24.4589 50.6496 24.7755 49.9745 24.0691C49.5517 23.6271 49.2681 23.688 48.887 24.2031C47.6481 25.8787 45.9534 26.3885 43.9663 25.8613C43.2912 25.6821 43.0563 25.8021 43.0337 26.5242C42.9971 27.7057 42.8179 28.8819 42.7849 30.0617C42.7066 32.7987 41.3546 34.7509 39.1152 36.1691C33.9683 39.4263 25.2491 38.7947 20.6294 34.8449C18.4718 33.0005 17.3791 30.7455 17.8054 27.8466C17.9707 26.7191 17.9864 25.569 18.1029 24.4328C18.1604 23.8707 18.0281 23.6567 17.4052 23.7298C15.3137 23.9804 13.6868 23.2252 12.6968 21.3286C12.401 20.7614 12.1104 20.6604 11.618 21.0276C10.7741 21.6575 10.5653 21.1233 10.4365 20.3942C10.1129 18.5324 10.6714 16.9073 11.8268 15.4457ZM15.0893 17.946C15.1258 17.9843 15.1641 18.0226 15.2006 18.0609C15.3642 19.4755 15.9697 20.0967 17.2399 20.1558C18.6145 20.2185 19.7977 19.3189 20.0744 18.0017C20.5529 15.7223 18.2804 13.9841 15.8618 14.8297C15.5904 14.9254 14.2523 14.8401 15.3816 15.8006C15.5573 15.9503 15.2789 16.133 15.1519 16.2582C14.8109 16.5975 14.562 16.9873 14.4228 17.4501C14.1897 18.2314 14.6664 18.0504 15.0893 17.946ZM32.8355 27.9771C32.9051 26.693 31.9986 25.5307 30.6031 25.3898C29.2355 25.2523 28.0766 26.2772 27.9305 27.7979C27.8034 29.1308 27.6921 30.4688 27.6364 31.8069C27.5755 33.2841 28.5325 34.3803 29.8949 34.4847C31.1686 34.5839 32.2944 33.6513 32.4736 32.2384C32.6424 30.9108 32.705 29.5692 32.8355 27.9771ZM42.4682 19.7191C42.4769 20.9823 43.3469 22.0925 44.5631 22.3917C45.7881 22.6928 46.4893 22.296 47.1923 20.904C47.2427 20.8049 47.2723 20.6622 47.3558 20.6152C48.198 20.1454 48.1893 20.1176 47.85 19.3328C47.6934 18.9726 46.8564 18.5237 47.9039 18.1653C48.0953 18.0992 47.8569 17.9025 47.7717 17.8016C47.1644 17.0778 45.3653 16.7681 44.2134 17.1804C43.1015 17.5789 42.4595 18.515 42.4682 19.7191ZM22.4651 26.4407C22.5051 26.954 22.5156 27.5404 23.396 27.1245C23.8467 26.9105 24.3147 27.0167 24.7584 27.2272C25.5815 27.617 25.959 27.3681 25.9643 26.4459C25.9695 25.529 25.1673 24.7042 24.2521 24.6833C23.3316 24.6642 22.5051 25.4454 22.4651 26.4407ZM36.8097 25.703C35.8249 25.6803 35.0349 26.3624 34.9827 27.269C34.9461 27.9041 34.974 28.5252 35.9293 28.1076C36.3469 27.9249 36.7731 28.0398 37.1977 28.1825C37.4935 28.2816 37.7006 28.8367 38.0921 28.4382C38.4087 28.1181 38.5097 27.6744 38.4279 27.2272C38.2608 26.298 37.6936 25.7795 36.8097 25.703Z"
                            fill="white" />
                        <path
                            d="M14.0017 63.2335C14.2227 57.9648 20.4641 52.7256 25.6493 53.5052C28.7935 53.9784 31.3321 56.5832 31.7306 59.7518C31.7897 60.2216 31.835 60.6931 31.8646 61.1646C32.0316 63.8738 33.2809 65.9531 35.5012 67.4861C36.446 68.1386 37.4447 68.6884 38.4731 69.193C38.7915 69.3496 39.1343 69.4818 39.4057 69.6993C41.3458 71.2514 40.1957 73.0871 39.8164 74.8202C39.484 76.3392 38.6888 77.1465 37.3908 77.1622C31.7897 77.2283 26.3418 76.5219 21.5516 73.3046C18.1185 70.9991 15.9018 67.8341 15.385 63.6476C15.204 62.1825 14.4872 63.5502 14.0017 63.2335Z"
                            fill="white" />
                        <path
                            d="M39.1065 52.7253C35.4925 52.9636 31.9308 52.5078 28.4281 51.6934C24.6958 50.8269 21.2715 51.2706 18.016 53.3847C15.6235 54.9385 12.93 53.4526 12.7438 50.6042C12.5315 47.3591 13.3041 44.328 14.884 41.5179C16.845 38.0327 19.9456 37.0635 23.5057 38.8488C25.5119 39.8545 27.445 41.0133 29.3886 42.1391C33.5855 44.5699 38.0138 46.0071 42.9397 45.4138C43.3295 45.3668 43.728 45.3738 44.1212 45.3877C44.8276 45.412 45.4314 45.6974 45.8873 46.2281C47.2689 47.8324 46.2892 49.4697 45.8421 51.0427C45.5184 52.1772 44.5249 52.687 43.3626 52.7166C41.9462 52.7531 40.5264 52.7253 39.1065 52.7253Z"
                            fill="white" />
                        <path
                            d="M53.0684 51.4326C55.6314 55.4799 56.6493 59.7568 55.4348 64.3434C54.7074 67.0874 52.6577 68.1749 49.8911 67.5607C48.5652 67.2666 47.3559 66.7063 46.2302 65.9634C45.9396 65.772 45.6577 65.5301 45.4489 65.2552C44.1282 63.5117 45.5063 58.9094 47.6413 58.591C50.8307 58.1142 52.3393 56.4403 52.5359 53.3223C52.5759 52.6837 52.8839 52.0625 53.0684 51.4326Z"
                            fill="white" />
                        <path
                            d="M53.9401 48.1091C54.6239 46.0768 55.1267 44.2167 55.4991 42.3201C55.7236 41.1735 55.4626 40.2165 54.5873 39.4335C54.382 39.249 54.208 39.0228 53.9801 38.8715C51.6763 37.3472 51.4623 35.3219 52.3636 32.8876C53.0387 31.0606 54.6274 30.2793 56.3952 31.2085C59.4228 32.7989 60.9662 35.435 61.5091 38.7305C61.5908 39.2299 61.61 39.738 61.6761 40.434C60.392 39.5257 60.2615 40.3087 60.0266 41.2274C59.5255 43.1954 58.6972 45.0206 57.2043 46.4683C56.343 47.3035 55.3512 47.8881 53.9401 48.1091Z"
                            fill="white" />
                        <path
                            d="M15.0894 17.9458C15.1416 17.918 15.1938 17.8901 15.2442 17.8623C15.2303 17.9284 15.2146 17.9945 15.2007 18.0607C15.1624 18.0224 15.1259 17.9841 15.0894 17.9458Z"
                            fill="white" />
                    </svg>
                </a> </li>
            <li class="active"><a href="Projet.html">Accueil</a>
            <li>
            <li><a href="">Nos NFT en vedette</a>
            <li>
            <li><a href="">Nos créateurs</a>
            <li>
            <li><a href="">Un NFT ? c’est quoi ?</a>
            <li>
            <li><a href="">Mes Favoris</a>
            <li>
        </ul>
    </nav>
</header>

<body>
    <input id="searchbar" onkeyup="search()" type="text" name="search" placeholder="Recherche un Nft">
    <div class="card">
        <div class="card__inner">
            <div class="card__face card__face--front">

            </div>
            <div class="card__face card__face--back">
                <div class="card__content">
                    <h2>test</h2>
                </div>
            </div>
        </div>
    </div>
    <div class="card_NFT" id="nft">
        <script>
            async function getNFT() {
                let newitems = [];
                const osContainer = document.getElementById('nft')
                const items = await fetch(`https://awesome-nft-app.herokuapp.com/`)
                    .then((res) => res.json())
                    .then((res) => {
                        return res.assets
                    })
                    .catch((e) => {
                        console.error(e)
                        return null
                    })

                if (items.length === 0) { return }
                //Sort NFT by number of click save in localstorage
                if (window.localStorage.getItem('ClickList')) {
                    const list = JSON.parse(window.localStorage.getItem('ClickList'));
                    const entries = Object.entries(list);
                    entries.sort(function (a, b) {
                        return a[1] - b[1];
                    });
                    entries.reverse()
                    console.log(entries)
                    entries.forEach((idcount) => {
                        items.forEach((nft) => {
                            if (nft.id == idcount[0]) {
                                newitems.push(nft);
                            }
                        })
                    })
                    items.forEach((idsearch) => {
                        if (newitems.indexOf(idsearch) == -1) {
                            newitems.push(idsearch);
                        }
                    })
                } else {
                    newitems = items;
                };
                console.log(newitems)
                newitems.forEach((nft) => {
                    const { name, image_url, description, permalink, id } = nft
                    const newElement = document.createElement('div')
                    //Add fav class if NFT is in fav list in localstorage
                    if (window.localStorage.getItem('favoritesList')) {
                        let listOnLoad = JSON.parse(window.localStorage.getItem('favoritesList'));
                        if (listOnLoad.includes(id)) {
                            var classfav = 'fav';
                        }
                        else {
                            var classfav = '';
                        }
                    }

                    newElement.innerHTML = `
                        <div onclick="clicks.initButton(this);" class="card" dataNbClick="${id}">
                            <div class="card__inner" id="test">
                                <div class="card__face card__face--front">
                                    <div class="card_nft card__face--front">
                                        <img class="card_img" src ="${image_url}">
                                        <div class="card_text">
                                            <p class="desc"> ${name}</p>
                                            <p class="description"> ${description}</p>
                                        </div>
                                        <svg onclick="favorites.initButton(this);" class="shop-item__favorite-button ${classfav}" data-add-to-favorite="${id}" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 455 455" style="enable-background:new 0 0 455 455;" xml:space="preserve">
                                        <style type="text/css">
                                            .st0{fill:transparent;}
                                        </style>
                                        <path class="st0" d="M326.6,10.3c-38.7,0-75,17.5-99.1,46.9c-24.1-29.4-60.4-46.9-99.1-46.9C57.6,10.3,0,67.9,0,138.7  c0,55.4,33,119.5,98.2,190.5c50.2,54.6,104.7,97,120.3,108.6l9,6.8l9-6.8c15.5-11.7,70.1-54,120.3-108.6  c65.2-71,98.2-135.1,98.2-190.5C455,67.9,397.4,10.3,326.6,10.3z"/>
                                        <path d="M326.6,10.3c-38.7,0-75,17.5-99.1,46.9c-24.1-29.4-60.4-46.9-99.1-46.9C57.6,10.3,0,67.9,0,138.7  c0,55.4,33,119.5,98.2,190.5c50.2,54.6,104.7,97,120.3,108.6l9,6.8l9-6.8c15.5-11.7,70.1-54,120.3-108.6  c65.2-71,98.2-135.1,98.2-190.5C455,67.9,397.4,10.3,326.6,10.3z M334.7,309c-41.3,44.9-85.6,81.3-107.2,98  c-21.5-16.7-65.9-53.1-107.2-98C61.2,244.6,30,185.7,30,138.7c0-54.2,44.1-98.4,98.4-98.4c35.7,0,68.7,19.5,86,50.8l13.1,23.7  l13.1-23.7c17.4-31.3,50.3-50.8,86-50.8c54.2,0,98.4,44.1,98.4,98.4C425,185.7,393.8,244.6,334.7,309z"/>
                                        </svg>
                                        <button ></button>

                                    </div>
                                </div>
                                <div class="card__face card__face--back">
                                    <div class="card_nft">
                                        <div class="card_text">
                                            <p class="description"> ${description}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card_nft">
                                <img class="card_img" src ="${image_url}">
                                <div class="card_text">
                                    <p class="desc"> ${name}</p>
                                    <p class="description"> ${description}</p>
                                </div>
                            </div>
                        `
                    const carte = document.querySelector(".card__inner");
                    newElement.addEventListener("click",
                        function (e) {
                            carte.classList.toggle('is-flipped');
                        });

                    osContainer.appendChild(newElement)
                })
            }
            getNFT()
        </script>
    </div>

    </div>
</body>

<footer>

</footer>

</html>
